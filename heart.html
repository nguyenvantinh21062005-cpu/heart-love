<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
 <HEAD>
  <TITLE> Heart </TITLE>
  <META NAME="Generator" CONTENT="EditPlus">
  <META NAME="Author" CONTENT="">
  <META NAME="Keywords" CONTENT="">
  <META NAME="Description" CONTENT="">
    
  <style>
  html, body {
  height: 100%;
  padding: 0;
  margin: 0;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column; /* để pinkboard trên, text3d dưới */
}

.box {
  width: 100%;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}

canvas {
  display: block;
}

#pinkboard {
  position: relative;
  margin: auto;
  height: 420px;
  width: 420px;
  animation: animate 1.3s infinite;
}

#pinkboard:before, #pinkboard:after {
  content: '';
  position: absolute;
  background: #FF5CA4;
  width: 100px;
  height: 160px;
  border-top-left-radius: 50px;
  border-top-right-radius: 50px;
}

#pinkboard:before {
  left: 100px;
  transform: rotate(-45deg);
  transform-origin: 0 100%;
  box-shadow: 0 14px 28px rgba(0,0,0,0.25),
              0 10px 10px rgba(0,0,0,0.22);
}

#pinkboard:after {
  left: 0;
  transform: rotate(45deg);
  transform-origin: 100% 100%;
}

@keyframes animate {
  0% { transform: scale(1); }
  30% { transform: scale(.8); }
  60% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

#text3d {
  width: 420px;
  height: 220px;
  margin-top: 12px;
  position: relative;
}
  </style>
 </HEAD>
 
 <BODY>
   <div class="box">
      <canvas id="pinkboard"></canvas>
   </div>

   <div id="text3d"></div>

  <script>
  /* --- Particle heart giữ nguyên --- */
  var settings = {
    particles: { length:2000,duration:2,velocity:100,effect:-1.3,size:13 }
  };
  (function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());
  var Point=function(x,y){this.x=x||0;this.y=y||0};Point.prototype={clone:function(){return new Point(this.x,this.y)},length:function(length){if(length===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);this.normalize();this.x*=length;this.y*=length;return this},normalize:function(){var l=this.length();this.x/=l;this.y/=l;return this}};
  var Particle=function(){this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0};
  Particle.prototype={initialize:function(x,y,dx,dy){this.position.x=x;this.position.y=y;this.velocity.x=dx;this.velocity.y=dy;this.acceleration.x=dx*settings.particles.effect;this.acceleration.y=dy*settings.particles.effect;this.age=0},update:function(dt){this.position.x+=this.velocity.x*dt;this.position.y+=this.velocity.y*dt;this.velocity.x+=this.acceleration.x*dt;this.velocity.y+=this.acceleration.y*dt;this.age+=dt},draw:function(c,image){function ease(t){return(--t)*t*t+1}var size=image.width*ease(this.age/settings.particles.duration);c.globalAlpha=1-this.age/settings.particles.duration;c.drawImage(image,this.position.x-size/2,this.position.y-size/2,size,size)}};
  var ParticlePool=function(length){particles=new Array(length);for(var i=0;i<particles.length;i++)particles[i]=new Particle();this.firstActive=0;this.firstFree=0;this.duration=settings.particles.duration;this.particles=particles};
  ParticlePool.prototype.add=function(x,y,dx,dy){this.particles[this.firstFree].initialize(x,y,dx,dy);this.firstFree++;if(this.firstFree==this.particles.length)this.firstFree=0;if(this.firstActive==this.firstFree)this.firstActive++;if(this.firstActive==this.particles.length)this.firstActive=0};
  ParticlePool.prototype.update=function(dt){var i;if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].update(dt)}if(this.firstFree<this.firstActive){for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].update(dt);for(i=0;i<this.firstFree;i++)this.particles[i].update(dt)}while(this.particles[this.firstActive].age>=this.duration&&this.firstActive!=this.firstFree){this.firstActive++;if(this.firstActive==this.particles.length)this.firstActive=0}};
  ParticlePool.prototype.draw=function(c,image){if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].draw(c,image)}if(this.firstFree<this.firstActive){for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].draw(c,image);for(i=0;i<this.firstFree;i++)this.particles[i].draw(c,image)}};
  (function(canvas){var context=canvas.getContext('2d'),pool=new ParticlePool(settings.particles.length),rate=settings.particles.length/settings.particles.duration,time;function pointOnHeart(t){return new Point(160*Math.pow(Math.sin(t),3),130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25)}var image=(function(){var c=document.createElement('canvas'),ctx=c.getContext('2d');c.width=settings.particles.size;c.height=settings.particles.size;function to(t){var p=pointOnHeart(t);p.x=settings.particles.size/2+p.x*settings.particles.size/350;p.y=settings.particles.size/2-p.y*settings.particles.size/350;return p}ctx.beginPath();var t=-Math.PI,p=to(t);ctx.moveTo(p.x,p.y);while(t<Math.PI){t+=0.01;p=to(t);ctx.lineTo(p.x,p.y)}ctx.closePath();ctx.fillStyle='#FF5CA4';ctx.fill();var img=new Image();img.src=c.toDataURL();return img})();function render(){requestAnimationFrame(render);var newTime=new Date().getTime()/1000,dt=newTime-(time||newTime);time=newTime;context.clearRect(0,0,canvas.width,canvas.height);var amount=rate*dt;for(var i=0;i<amount;i++){var pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());var dir=pos.clone().length(settings.particles.velocity);pool.add(canvas.width/2+pos.x,canvas.height/2-pos.y,dir.x,-dir.y)}pool.update(dt);pool.draw(context,image)}function onResize(){var el=document.getElementById('pinkboard');canvas.width=el.clientWidth;canvas.height=el.clientHeight}window.onresize=onResize;setTimeout(function(){onResize();render()},10)})(document.getElementById('pinkboard'));
  </script>

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>
  (function(){
    const container = document.getElementById('text3d');
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio||1);
    function setRendererSize(){renderer.setSize(container.clientWidth,container.clientHeight)}
    setRendererSize();container.appendChild(renderer.domElement);
    const scene=new THREE.Scene();
    const camera=new THREE.PerspectiveCamera(45,container.clientWidth/container.clientHeight,0.1,1000);
    camera.position.set(0,6,28);
    const textGroup=new THREE.Group();scene.add(textGroup);
    const cache={};
    function makeCharTexture(ch,color){const key=ch+'|'+color;if(cache[key])return cache[key];const size=128,c=document.createElement('canvas');c.width=size;c.height=size;const ctx=c.getContext('2d');ctx.clearRect(0,0,size,size);ctx.font='80px sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=color;ctx.shadowBlur=24;ctx.shadowColor=color;ctx.fillText(ch,size/2,size/2);const tex=new THREE.CanvasTexture(c);tex.needsUpdate=true;cache[key]=tex;return tex}
    function createTextRing(msg,count,radius,yOffset,charSize){const g=new THREE.Group();for(let i=0;i<count;i++){const ch=msg[i%msg.length];const hue=(i/count);const color=`hsl(${Math.floor(hue*360)},100%,60%)`;const tex=makeCharTexture(ch,color);const geom=new THREE.PlaneGeometry(charSize||2.2,charSize||2.2);const mat=new THREE.MeshBasicMaterial({map:tex,transparent:true,depthWrite:false});const mesh=new THREE.Mesh(geom,mat);const angle=(i/count)*Math.PI*2;mesh.position.x=Math.cos(angle)*radius;mesh.position.z=Math.sin(angle)*radius;mesh.position.y=yOffset+Math.sin(i*0.25)*0.8;mesh.lookAt(0,mesh.position.y,0);g.add(mesh);}return g}

    /* --- Phần sửa: auto count theo chu vi --- */
    const message="Anh Yêu Em ♥ ";
    const rings=new THREE.Group();

    for(let r=0;r<5;r++){
      const radius=6+r*1.2;
      const y=15-r*1.2;
      const charSize=2.5-r*0.12;

      const circumference = 2 * Math.PI * radius;
      const count = Math.floor(circumference / (charSize * 1.2));

      const ring=createTextRing(message,count,radius,y,charSize);
      rings.add(ring);
    }

    textGroup.add(rings);

    function animate(){
      requestAnimationFrame(animate);
      textGroup.rotation.y+=0.012;
      rings.children.forEach((ring,idx)=>{
        ring.rotation.x=Math.sin(Date.now()*0.001+idx)*0.05
      });
      renderer.render(scene,camera)
    }
    animate();

    window.addEventListener('resize',()=>{
      setRendererSize();
      camera.aspect=container.clientWidth/container.clientHeight;
      camera.updateProjectionMatrix()
    });
  })();
  </script>

 </BODY>
</HTML>