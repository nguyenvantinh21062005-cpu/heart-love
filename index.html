<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
 <HEAD>
  <meta charset="utf-8">
  <TITLE> Heart </TITLE>

  <!-- Font ƒë·∫πp m·ªÅm m·∫°i -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">

  <style>
  html, body {
    height: 100%;
    padding: 0;
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }

  .box {
    width: 100%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #pinkboard {
    position: relative;
    margin: auto;
    height: 420px;
    width: 420px;
    transition: transform 0.08s linear, filter 0.12s linear;
  }

  #pinkboard:before, #pinkboard:after {
    content: '';
    position: absolute;
    background: #FF5CA4;
    width: 100px;
    height: 160px;
    border-top-left-radius: 50px;
    border-top-right-radius: 50px;
  }

  #pinkboard:before {
    left: 100px;
    transform: rotate(-45deg);
    transform-origin: 0 100%;
    box-shadow: 0 14px 28px rgba(0,0,0,0.25),
                0 10px 10px rgba(0,0,0,0.22);
  }

  #pinkboard:after {
    left: 0;
    transform: rotate(45deg);
    transform-origin: 100% 100%;
  }

  /* ch·ªØ gi·ªØa tr√°i tim */
  #centerText {
    position: absolute;
    text-align: center;
    color: #fff;
    font-size: 38px;
    font-family: 'Great Vibes', cursive; /* Font ƒë·∫πp m·ªÅm m·∫°i */
    font-weight: 400;
    letter-spacing: 1px;
    text-shadow: 0 0 15px #fff;
    pointer-events: none;
    z-index: 10;
    white-space: nowrap;

    opacity: 0;             /* ·∫®n m·∫∑c ƒë·ªãnh */
    transition: opacity 0.6s ease, transform 0.08s linear, color 0.08s linear, text-shadow 0.12s linear;
  }
  #centerText.show {
    opacity: 1;             /* Hi·ªán khi ph√°t nh·∫°c */
  }

  #musicBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    background: #ff4d6d;
    color: white;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
  }
  #musicBtn:hover { background: #ff335a; }
  </style>
 </HEAD>
 
 <BODY>
   <div class="box">
      <canvas id="pinkboard"></canvas>
      <div id="centerText">üòò Anh Y√™u Em ‚ô•Ô∏è</div>
   </div>

  <!-- Heart particles -->
  <script>
  var settings = {particles:{length:2000,duration:2,velocity:100,effect:-1.3,size:13}};
  (function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());
  var Point=function(x,y){this.x=x||0;this.y=y||0};Point.prototype={clone:function(){return new Point(this.x,this.y)},length:function(length){if(length===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);this.normalize();this.x*=length;this.y*=length;return this},normalize:function(){var l=this.length();this.x/=l;this.y/=l;return this}};
  var Particle=function(){this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0};
  Particle.prototype={initialize:function(x,y,dx,dy){this.position.x=x;this.position.y=y;this.velocity.x=dx;this.velocity.y=dy;this.acceleration.x=dx*settings.particles.effect;this.acceleration.y=dy*settings.particles.effect;this.age=0},update:function(dt){this.position.x+=this.velocity.x*dt;this.position.y+=this.velocity.y*dt;this.velocity.x+=this.acceleration.x*dt;this.velocity.y+=this.acceleration.y*dt;this.age+=dt},draw:function(c,image){function ease(t){return(--t)*t*t+1}var size=image.width*ease(this.age/settings.particles.duration);c.globalAlpha=1-this.age/settings.particles.duration;c.drawImage(image,this.position.x-size/2,this.position.y-size/2,size,size)}};
  var ParticlePool=function(length){particles=new Array(length);for(var i=0;i<particles.length;i++)particles[i]=new Particle();this.firstActive=0;this.firstFree=0;this.duration=settings.particles.duration;this.particles=particles};
  ParticlePool.prototype.add=function(x,y,dx,dy){this.particles[this.firstFree].initialize(x,y,dx,dy);this.firstFree++;if(this.firstFree==this.particles.length)this.firstFree=0;if(this.firstActive==this.firstFree)this.firstActive++;if(this.firstActive==this.particles.length)this.firstActive=0};
  ParticlePool.prototype.update=function(dt){var i;if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].update(dt)}if(this.firstFree<this.firstActive){for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].update(dt);for(i=0;i<this.firstFree;i++)this.particles[i].update(dt)}while(this.particles[this.firstActive].age>=this.duration&&this.firstActive!=this.firstFree){this.firstActive++;if(this.firstActive==this.particles.length)this.firstActive=0}};
  ParticlePool.prototype.draw=function(c,image){if(this.firstActive<this.firstFree){for(i=this.firstActive;i<this.firstFree;i++)this.particles[i].draw(c,image)}if(this.firstFree<this.firstActive){for(i=this.firstActive;i<this.particles.length;i++)this.particles[i].draw(c,image);for(i=0;i<this.firstFree;i++)this.particles[i].draw(c,image)}};
  (function(canvas){var context=canvas.getContext('2d'),pool=new ParticlePool(settings.particles.length),rate=settings.particles.length/settings.particles.duration,time;function pointOnHeart(t){return new Point(160*Math.pow(Math.sin(t),3),130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25)}var image=(function(){var c=document.createElement('canvas'),ctx=c.getContext('2d');c.width=settings.particles.size;c.height=settings.particles.size;function to(t){var p=pointOnHeart(t);p.x=settings.particles.size/2+p.x*settings.particles.size/350;p.y=settings.particles.size/2-p.y*settings.particles.size/350;return p}ctx.beginPath();var t=-Math.PI,p=to(t);ctx.moveTo(p.x,p.y);while(t<Math.PI){t+=0.01;p=to(t);ctx.lineTo(p.x,p.y)}ctx.closePath();ctx.fillStyle='#FF5CA4';ctx.fill();var img=new Image();img.src=c.toDataURL();return img})();function render(){requestAnimationFrame(render);var newTime=new Date().getTime()/1000,dt=newTime-(time||newTime);time=newTime;context.clearRect(0,0,canvas.width,canvas.height);var amount=rate*dt;for(var i=0;i<amount;i++){var pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());var dir=pos.clone().length(settings.particles.velocity);pool.add(canvas.width/2+pos.x,canvas.height/2-pos.y,dir.x,-dir.y)}pool.update(dt);pool.draw(context,image)}function onResize(){canvas.width=420;canvas.height=420}window.onresize=onResize;setTimeout(function(){onResize();render()},10)})(document.getElementById('pinkboard'));
  </script>

  <!-- Nh·∫°c + hi·ªáu ·ª©ng tim + ch·ªØ -->
  <audio id="music" src="music.mp3" loop></audio>
  <button id="musicBtn">Play</button>

  <script>
    const audio = document.getElementById("music");
    const btn = document.getElementById("musicBtn");
    const centerText = document.getElementById("centerText");
    const heartEl = document.getElementById("pinkboard");

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const src = audioCtx.createMediaElementSource(audio);
    const analyser = audioCtx.createAnalyser();

    src.connect(analyser);
    analyser.connect(audioCtx.destination);
    analyser.fftSize = 256;

    const dataArray = new Uint8Array(analyser.frequencyBinCount);

    function animateBeat() {
      requestAnimationFrame(animateBeat);
      analyser.getByteFrequencyData(dataArray);

      let bass = 0;
      for (let i = 0; i < 10; i++) bass += dataArray[i];
      bass = bass / 10;

      let textScale = 1 + (bass / 700);
      centerText.style.transform = `scale(${textScale})`;

      let hue = (bass * 5) % 360;
      centerText.style.color = `hsl(${hue}, 100%, 60%)`;
      centerText.style.textShadow = `0 0 ${6 + bass/6}px hsl(${hue},100%,70%)`;

      let heartScale = 1 + (bass / 300);
      heartEl.style.transform = `scale(${heartScale})`;
      heartEl.style.filter = `drop-shadow(0 0 ${Math.max(0,bass/3)}px hsl(${hue},100%,70%))`;
    }

    btn.addEventListener("click", () => {
      if (audio.paused) {
        audio.play();
        audioCtx.resume().then(() => animateBeat());
        centerText.classList.add("show");   // hi·ªán ch·ªØ
        btn.textContent = "Stop";
      } else {
        audio.pause();
        centerText.classList.remove("show"); // ·∫©n ch·ªØ khi d·ª´ng
        btn.textContent = "Play";
      }
    });
  </script>

 </BODY>
</HTML>